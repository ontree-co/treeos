{{ define "content" }}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="/apps/{{ .AppName }}">{{ .AppName }}</a></li>
                <li class="breadcrumb-item active">Edit Multi-Service Configuration</li>
            </ol>
        </nav>
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>‚úèÔ∏è Edit Multi-Service Application: {{ .AppName }}</h1>
            <div>
                <a href="/apps/{{ .AppName }}" class="btn btn-outline-secondary">
                    ‚Üê Back to App Details
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Warning Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-warning">
            <h5>‚ö†Ô∏è Important Notes</h5>
            <p class="mb-2">
                Editing the docker-compose.yml file will update the configuration for your multi-service application.
            </p>
            <p class="mb-2">
                If the application is currently running, you may need to restart it for changes to take effect.
            </p>
            <p class="mb-0">
                <strong>Security:</strong> All bind mounts must use the pattern 
                <code>/opt/ontree/apps/mount/{{ .AppName }}/{serviceName}/</code>.
            </p>
        </div>
    </div>
</div>

<!-- Edit Form -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üìù Edit Configuration</h5>
            </div>
            <div class="card-body">
                <form method="post" action="/apps/{{ .AppName }}/edit-multiservice">
                    {{ if .Errors }}
                        <div class="alert alert-danger">
                            <ul class="mb-0">
                                {{ range .Errors }}
                                <li>{{ . }}</li>
                                {{ end }}
                            </ul>
                        </div>
                    {{ end }}
                    
                    <!-- Emoji Picker -->
                    <div class="mb-4">
                        <label class="form-label">
                            <strong>App Icon</strong>
                        </label>
                        {{ template "emoji-picker.html" . }}
                    </div>
                    
                    <!-- Docker Compose Content Field -->
                    <div class="mb-4">
                        <label for="compose_content" class="form-label">
                            <strong>docker-compose.yml Content</strong>
                        </label>
                        <textarea class="form-control font-monospace" id="compose_content" name="compose_content" 
                                  rows="20" required>{{ .FormData.compose_content }}</textarea>
                        <div class="form-text">
                            Edit the docker-compose.yml configuration for your multi-service application.
                        </div>
                    </div>
                    
                    <!-- Environment Variables Field -->
                    <div class="mb-4">
                        <label for="env_content" class="form-label">
                            <strong>.env Content (Optional)</strong>
                        </label>
                        <textarea class="form-control font-monospace" id="env_content" name="env_content" 
                                  rows="10" placeholder="# Environment variables
DB_PASSWORD=secret123
API_KEY=your-api-key-here
DEBUG=false">{{ .FormData.env_content }}</textarea>
                        <div class="form-text">
                            Optional: Environment variables that will be available to all services.
                            Leave empty to remove the .env file.
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            üíæ Save Changes
                        </button>
                        <a href="/apps/{{ .AppName }}" class="btn btn-outline-secondary btn-lg">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Help Section -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üÜò Quick Reference</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Service Communication</h6>
                        <p class="small">
                            Services can communicate with each other using their service names as hostnames.
                            For example, a <code>web</code> service can connect to a <code>database</code> service
                            using <code>database:5432</code>.
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h6>Volume Mounts</h6>
                        <p class="small">
                            For security, all bind mounts must follow the pattern:<br>
                            <code>/opt/ontree/apps/mount/{{ .AppName }}/{serviceName}/:{containerPath}</code>
                        </p>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6>Environment Variables</h6>
                        <p class="small">
                            Variables defined in the .env file are available to all services.
                            You can also define service-specific variables in the <code>environment</code>
                            section of each service.
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h6>Port Mapping</h6>
                        <p class="small">
                            Only expose ports that need to be accessible from outside the application.
                            Services can communicate internally without exposed ports.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Custom styles for the form */
.form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.font-monospace {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9em;
}

textarea.form-control {
    min-height: 200px;
}

pre code {
    font-size: 0.85em;
    line-height: 1.4;
}

.alert h5 {
    margin-bottom: 0.75rem;
}
</style>
{{ end }}